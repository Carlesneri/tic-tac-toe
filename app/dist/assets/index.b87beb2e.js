var V=Object.defineProperty;var k=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var H=(e,t,s)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,T=(e,t)=>{for(var s in t||(t={}))X.call(t,s)&&H(e,s,t[s]);if(k)for(var s of k(t))q.call(t,s)&&H(e,s,t[s]);return e};import{j as b,r as i,a as D,u as J,v as Y,R as z,b as Q}from"./vendor.046a45de.js";const Z=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}};Z();const a=b.exports.jsx,w=b.exports.jsxs,ee=b.exports.Fragment,v=i.exports.createContext(),te=({children:e})=>{const[t,s]=i.exports.useState(Array(9).fill({player:0,throw:0})),[n,r]=i.exports.useState([]),[o,u]=i.exports.useState(null),[m,p]=i.exports.useState([]),[f,x]=i.exports.useState(!1);return a(v.Provider,{value:{boxes:t,setBoxes:s,turn:o,setTurn:u,winnerPositions:n,setWinnerPositions:r,history:m,setHistory:p,arePlaying:f,setArePlaying:x},children:e})},se=e=>[`(^${e}{3})`,`(...${e}{3}...)`,`(${e}{3}$)`,`(^${e}..${e}..${e})`,`(^.${e}..${e}..${e})`,`(${e}..${e}..${e}$)`,`(^${e}...${e}...${e})`,`(..${e}.${e}.${e}..)`];var U=e=>new RegExp(se(e).join("|"));const ne={0:[0,1,2],1:[3,4,5],2:[6,7,8],3:[0,3,6],4:[1,4,7],5:[2,5,8],6:[0,4,8],7:[2,4,6]};var W=e=>{const t=[];return e.reduce((n,r,o)=>r?[...n,o]:n,[]).forEach(n=>{t.push(...ne[n])}),t},A=e=>{const t=e.map(u=>u.player).join(""),s=U(1),n=U(2),r=t.match(s),o=t.match(n);if(r){const u=W(r.slice(1,9));return{winner:1,positions:u}}if(o){const u=W(o.slice(1,9));return{winner:2,positions:u}}return null},G=e=>9-e+1,C=e=>e.reduce((s,n,r)=>n.player===0?[...s,r]:[...s],[]),R={COMPUTER_TIME:1e3,BUTTON_VALUES:{0:"",1:"O",2:"X"},WINNER_MESSAGE:{0:"draw!",1:"you win!",2:"computer wins!"},PLAYERS:{1:"user",2:"computer"},RESULTS:{draw:"draw",1:"win",2:"lose"},BASE_URL:"/game",COOKIE_SESSION_NAME:"tic-tac-toe.sid"},re=(e,t)=>{const s=oe(e,t);if(s)return s;const n=Math.floor(Math.random()*e.length);return e[n]};const oe=(e,t)=>{for(const s of e){const n=[...t];if(n[s]={player:2},A(n))return s}for(const s of e){const n=[...t];if(n[s]={player:1},A(n))return s}return null},{BASE_URL:M,RESULTS:j,COOKIE_SESSION_NAME:O}=R,I=D.create({withCredentials:!0});var _=()=>{const{boxes:e,setBoxes:t,turn:s,setTurn:n,setHistory:r,arePlaying:o,setArePlaying:u,setWinnerPositions:m}=i.exports.useContext(v),[p,f]=J([O]),x=()=>{l(),u(!0);const c=Math.ceil(Math.random()*2);n(c)},l=()=>{t(Array(9).fill({player:0,throw:0})),m([])},E=c=>{if(s===1&&!y()){const d=C(e);t(g=>(g[c]={player:1,throw:G(d.length)},[...g]))}},S=()=>{if(s===2&&!y()){const c=C(e),d=re(c,e);t(g=>(g[d]={player:2,throw:G(c.length)},[...g]))}},h=()=>{s!==null&&n(s===1?2:1)},y=()=>A(e),P=async()=>{if(!o)return;let c;const d=y();if(!d)c=j.draw;else{const{winner:N}=d;c=j[N]}const g={game:{result:c,boxes:e}};try{await I.post(M,g),B()}catch(N){console.error(N)}},B=async()=>{p[O]||f(O,Y());try{const c=await I.get(M),{games:d}=c.data;r(d)}catch(c){console.error(c)}};return{startGame:x,playPlayer:E,playComputer:S,changeTurn:h,isWinner:y,saveGame:P,cleanHistory:async()=>{try{await I.delete(M),r([])}catch(c){console.error(c)}},fillBoard:c=>{o||(l(),c.forEach((d,g)=>{d.throw&&setTimeout(()=>{t(N=>(N[g]={player:d.player,throw:d.throw},[...N]))},d.throw*500)}))},updateHistory:B}};const{BUTTON_VALUES:ae}=R;function ie({value:e,position:t}){const s=ae[e],{turn:n,setTurn:r,winnerPositions:o,arePlaying:u}=i.exports.useContext(v),{playPlayer:m,changeTurn:p,isWinner:f}=_(),[x,l]=i.exports.useState("disabled");return i.exports.useEffect(()=>{if(o.length){const S=o.some(h=>h===t);l(S?"disabled winner":"disabled")}else(!u||n===2)&&l("disabled"),n===1&&e===0&&l(""),n===1&&e!==0&&l("taken")},[o,n]),a("div",{className:"box",children:a("button",{onClick:()=>{e===0&&(m(t),f()?r(null):p())},className:`${x} glass`,children:s})})}function ce(){const{boxes:e}=i.exports.useContext(v);return a("div",{className:"container",children:a("div",{className:"board",children:e.map((t,s)=>a(ie,{value:t.player,position:s},s))})})}function le(){return a("header",{children:a("h1",{children:"tic-tac-toe"})})}function ue(){const{history:e,arePlaying:t}=i.exports.useContext(v),[s,n]=i.exports.useState([]),{updateHistory:r,cleanHistory:o,fillBoard:u}=_(),[m,p]=i.exports.useState({});i.exports.useEffect(()=>{r()},[]),i.exports.useEffect(()=>{const l=e.sort((h,y)=>h.createdAt<y.createdAt?1:-1);n(l);const{won:E,loses:S}=e.reduce((h,y)=>y.result==="win"?T({won:h.won++},h):y.result==="lose"?T({loses:h.loses++},h):h,{won:0,loses:0});p({won:E,loses:S})},[e]);const f=()=>{o()},x=l=>{u(l)};return w("div",{className:"container history",children:[w("div",{className:"header",children:[a("h2",{children:"history"}),a("button",{className:"glass",onClick:f,children:"clean history"})]}),a("div",{className:"body",children:e.length>0?w(ee,{children:[w("div",{className:"score",children:["score: ",a("span",{className:"win",children:m.won})," / ",a("span",{className:"lose",children:m.loses})]}),a("ul",{children:s.map(l=>w("li",{className:"game",children:[a("span",{className:l.result,children:l.result}),!t&&a("button",{className:"glass",onClick:()=>x(l.boxes),children:"play"})]},l._id))})]}):a("div",{children:"No games saved"})})]})}const{COMPUTER_TIME:de,WINNER_MESSAGE:F,RESULTS:K}=R;function he(){const{boxes:e,turn:t,setTurn:s,setWinnerPositions:n,arePlaying:r,setArePlaying:o}=i.exports.useContext(v),[u,m]=i.exports.useState(!1),[p,f]=i.exports.useState(""),[x,l]=i.exports.useState(""),[E,S]=i.exports.useState(""),{startGame:h,playComputer:y,isWinner:P,changeTurn:B,saveGame:$}=_();i.exports.useEffect(()=>{r?(l(""),S("disabled"),f(u?"playing computer...":"play!")):S("")},[t,u,r]),i.exports.useEffect(()=>{if(P()){s(null),o(!1),$();const{winner:c,positions:d}=P();f(F[c]),l(K[c]),n([...d])}else C(e).length===0&&(s(null),o(!1),f(F[0]),l(K.draw),$()),n([])},[e]),i.exports.useEffect(()=>{t===2&&C(e).length!==0&&(m(!0),setTimeout(()=>{y(),B(),m(!1)},de))},[t]);const L=()=>{h(),n([])};return a("div",{className:"container",children:w("div",{className:"panel",children:[a("div",{className:"buttons",children:a("div",{children:a("button",{id:"startButton",className:`glass ${E}`,onClick:L,children:"start"})})}),a("div",{className:"message-container",children:p&&a("div",{className:`message ${x}`,children:p})})]})})}function fe(){return w(te,{children:[a(le,{}),a(he,{}),w("div",{className:"container board-history",children:[a(ce,{}),a(ue,{})]})]})}z.render(a(Q.StrictMode,{children:a(fe,{})}),document.getElementById("root"));
